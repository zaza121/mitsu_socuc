<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="planning_view_form_mitsu" model="ir.ui.view">
        <field name="name">planning.slot.form.mitsu</field>
        <field name="model">planning.slot</field>
        <field name="inherit_id" ref="planning.planning_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='recurrency_id']" position="after">
                <field name="related_projects_ids" invisible="1" />
                <field name="sol_ids" invisible="1" />
            </xpath>

            <xpath expr="//field[@name='role_id']" position="after">
                <field name="timesheet_id" invisible="timesheet_id == False" />
            </xpath>

            <xpath expr="//field[@name='sale_line_id']/.." position="after">
                <field name="task_id" domain="[('sale_line_id', '=', sale_line_id),('user_ids', 'in', user_id)]" />
            </xpath>

            <xpath expr="//header[1]" position="inside">
                <button name="generate_timesheet" type="object" string="Generer timesheet" invisible="timesheet_id" class="btn btn-sm btn-primary" groups="planning.group_planning_manager"/>
            </xpath>

        </field>
    </record>

    <record id="planning_view_form_in_gantt_mitsu" model="ir.ui.view">
        <field name="name">planning.slot.form.gantt</field>
        <field name="model">planning.slot</field>
        <field name="inherit_id" ref="planning.planning_view_form_in_gantt"/>
        <field name="arch" type="xml">
            <xpath expr="//footer/button[@special='cancel']" position="after">
                <field name="timesheet_id" invisible="True" />
                <button name="generate_timesheet" type="object" string="Generer timesheet" invisible="timesheet_id" class="btn btn-sm btn-primary" groups="planning.group_planning_manager"/>
            </xpath>
        </field>
    </record>

    <record id="planning_slot_view_form_inherit_sale_planning_mitsu" model="ir.ui.view">
        <field name="name">planning.slot.form.mitsu</field>
        <field name="model">planning.slot</field>
        <field name="inherit_id" ref="sale_planning.planning_slot_view_form_inherit_sale_planning"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='sale_line_id']/.." position="replace">
                <div class="o_row" name="sale_line_id_block">
                    <field name="sale_line_id" groups="!sales_team.group_sale_salesman" options="{'no_create': True, 'no_open': True}" context="{'with_planning_remaining_hours': True, 'with_price_unit': True}" domain="[('id', 'in', sol_ids),('is_service', '=', True)]"  />
                    <field name="sale_line_id" groups="sales_team.group_sale_salesman" options="{'no_create': True}" context="{'with_planning_remaining_hours': True, 'with_price_unit': True}" domain="[('id', 'in', sol_ids),('is_service', '=', True)]" />
                    <span class="fa fa-exclamation-triangle text-warning" title="The sales order associated with this shift has been cancelled. We recommend either updating the sales order item or unscheduling this shift in line with the cancellation of the sales order." invisible="sale_order_state != 'cancel'"/>
                </div>
            </xpath>

            <!-- <div class="o_row">
                    <field name="sale_line_id" groups="!sales_team.group_sale_salesman" options="{'no_create': True, 'no_open': True}" context="{'with_planning_remaining_hours': True, 'with_price_unit': True}"/>
                    <field name="sale_line_id" groups="sales_team.group_sale_salesman" options="{'no_create': True}" context="{'with_planning_remaining_hours': True, 'with_price_unit': True}"/>
                    <span class="fa fa-exclamation-triangle text-warning" title="The sales order associated with this shift has been cancelled. We recommend either updating the sales order item or unscheduling this shift in line with the cancellation of the sales order." invisible="sale_order_state != 'cancel'"/>
                </div> -->
        </field>
    </record>

    <record id="planning_view_gantt_mitsu" model="ir.ui.view">
        <field name="name">planning.slot.gantt.mitsu</field>
        <field name="model">planning.slot</field>
        <field name="inherit_id" ref="planning.planning_view_gantt"/>
        <field name="arch" type="xml">
            
            <xpath expr="//button[@name='unlink']" position="after">
                <field name="timesheet_id" invisible="True" />
                <button name="generate_timesheet" type="object" string="Generer timesheet" class="btn btn-sm btn-primary" groups="planning.group_planning_manager"/>
            </xpath>

        </field>
    </record>

</odoo>
